<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ramble.expander &mdash; Ramble 0.4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=6c02275b"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
          </a>
              <div class="version">
                0.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ramble.html">ramble package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration_files.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workspace.html">Ramble Workspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workspace_config.html">Workspace Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../success_criteria.html">Success Criteria</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/GoogleCloudPlatform/ramble#contributing">Contributing Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guides.html">Developer Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/spack/spack">Spack</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ramble</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ramble.expander</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ramble.expander</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2022-2024 Google LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 &lt;LICENSE-APACHE or</span>
<span class="c1"># https://www.apache.org/licenses/LICENSE-2.0&gt; or the MIT license</span>
<span class="c1"># &lt;LICENSE-MIT or https://opensource.org/licenses/MIT&gt;, at your</span>
<span class="c1"># option. This file may not be copied, modified, or distributed</span>
<span class="c1"># except according to those terms.</span>

<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">ramble.error</span>
<span class="kn">import</span> <span class="nn">ramble.keywords</span>
<span class="kn">from</span> <span class="nn">ramble.util.logger</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="kn">import</span> <span class="nn">spack.util.naming</span>

<span class="n">supported_math_operators</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Sub</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span>
    <span class="n">ast</span><span class="o">.</span><span class="n">Mult</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Div</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Pow</span><span class="p">:</span>
    <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BitXor</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">USub</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">,</span>
    <span class="n">ast</span><span class="o">.</span><span class="n">Eq</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">NotEq</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Gt</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">,</span>
    <span class="n">ast</span><span class="o">.</span><span class="n">GtE</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Lt</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">LtE</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span>
    <span class="n">ast</span><span class="o">.</span><span class="n">And</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Or</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Mod</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">mod</span>
<span class="p">}</span>

<span class="n">supported_scalar_function_pointers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">,</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="nb">min</span><span class="p">,</span>
    <span class="s1">&#39;ceil&#39;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">,</span>
    <span class="s1">&#39;floor&#39;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">,</span>
    <span class="s1">&#39;randrange&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">,</span>
    <span class="s1">&#39;randint&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">,</span>
    <span class="s1">&#39;simplify_str&#39;</span><span class="p">:</span> <span class="n">spack</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">naming</span><span class="o">.</span><span class="n">simplify_name</span>
<span class="p">}</span>

<span class="n">supported_list_function_pointers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">formatter</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">Formatter</span><span class="p">()</span>


<div class="viewcode-block" id="ExpansionDelimiter">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExpansionDelimiter">[docs]</a>
<span class="k">class</span> <span class="nc">ExpansionDelimiter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing the delimiters for ramble expansion strings&quot;&quot;&quot;</span>
    <span class="n">left</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span>
    <span class="n">right</span> <span class="o">=</span> <span class="s1">&#39;}&#39;</span>
    <span class="n">escape</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span></div>



<div class="viewcode-block" id="VformatDelimiter">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.VformatDelimiter">[docs]</a>
<span class="k">class</span> <span class="nc">VformatDelimiter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing the delimiters for the string.Formatter class&quot;&quot;&quot;</span>
    <span class="n">left</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span>
    <span class="n">right</span> <span class="o">=</span> <span class="s1">&#39;}&#39;</span></div>



<div class="viewcode-block" id="ExpansionNode">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExpansionNode">[docs]</a>
<span class="k">class</span> <span class="nc">ExpansionNode</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing a node in a ramble expansion graph&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left_idx</span><span class="p">,</span> <span class="n">right_idx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left_idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right_idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;   Node:&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;      Indices: (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;      Num Children: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;      Contents: &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;      Value: &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;      Is root: &quot;</span><span class="si">{</span><span class="bp">self</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<div class="viewcode-block" id="ExpansionNode.relative_indices">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExpansionNode.relative_indices">[docs]</a>
    <span class="k">def</span> <span class="nf">relative_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative_to</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute node indices relative to another node</span>

<span class="sd">        Args:</span>
<span class="sd">            relative_to (node): node to shift current node&#39;s indices relative to</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple) indices of shifted match set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">-</span> <span class="n">relative_to</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">relative_to</span><span class="o">.</span><span class="n">left</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExpansionNode.add_children">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExpansionNode.add_children">[docs]</a>
    <span class="k">def</span> <span class="nf">add_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add children to this node</span>

<span class="sd">        Args:</span>
<span class="sd">            children (node, or list): nodes to adds as children of self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">children</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExpansionNode.define_value">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExpansionNode.define_value">[docs]</a>
    <span class="k">def</span> <span class="nf">define_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expansion_dict</span><span class="p">,</span> <span class="n">allow_passthrough</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">expansion_func</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">evaluation_func</span><span class="o">=</span><span class="nb">eval</span><span class="p">,</span>
                     <span class="n">no_expand_vars</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the value for this node.</span>

<span class="sd">        Construct the value of self. This builds up a string representation of</span>
<span class="sd">        self, and performs evaluation and formatting of the resulting string.</span>
<span class="sd">        This includes extracting the values of the children nodes, and</span>
<span class="sd">        replacing their values in the proper positions in self&#39;s string.</span>

<span class="sd">        Stores the resulting value in self.value</span>

<span class="sd">        Args:</span>
<span class="sd">            expansion_dict (dict): variable definitions to use for expanding</span>
<span class="sd">            detected matches</span>
<span class="sd">            allow_passthrough (bool): if true, expansion is allowed to fail. if</span>
<span class="sd">            false, failed expansion raises an error.</span>
<span class="sd">            expansion_func (func): function to use for expansion of nested</span>
<span class="sd">            variable definitions</span>
<span class="sd">            evaluation_func (func): function to use for evaluating math of strings</span>
<span class="sd">            no_expand_vars (set): set of variable names that should never be expanded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">last_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">child_indices</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">relative_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="n">last_idx</span><span class="p">:</span><span class="n">child_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="n">last_idx</span> <span class="o">=</span> <span class="n">child_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">last_idx</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">):</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="n">last_idx</span><span class="p">:])</span>

            <span class="k">if</span> <span class="bp">self</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
                <span class="n">replaced_contents</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

                <span class="c1"># Special case &#39;{}&#39;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">replaced_contents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span>
                    <span class="k">return</span>

                <span class="n">format_kw</span> <span class="o">=</span> <span class="n">replaced_contents</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">kw_parts</span> <span class="o">=</span> <span class="n">format_kw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">required_passthrough</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">kw_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">expansion_dict</span><span class="p">:</span>
                    <span class="c1"># Exit expansion for variables defined as no_expand</span>
                    <span class="k">if</span> <span class="n">kw_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">no_expand_vars</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">expansion_dict</span><span class="p">[</span><span class="n">kw_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="k">return</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">expansion_func</span><span class="p">(</span><span class="n">expansion_dict</span><span class="p">,</span>
                                                    <span class="n">expansion_dict</span><span class="p">[</span><span class="n">kw_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                                    <span class="n">allow_passthrough</span><span class="o">=</span><span class="n">allow_passthrough</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">kw_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">required_passthrough</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Evaluation should go here</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">evaluation_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">old_value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="n">required_passthrough</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># If we had a format spec, add it</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kw_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">kw_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
                    <span class="n">format_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;value:</span><span class="si">{</span><span class="n">kw_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">vformat</span><span class="p">(</span><span class="n">VformatDelimiter</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span>
                                                       <span class="n">format_str</span> <span class="o">+</span>
                                                       <span class="n">VformatDelimiter</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
                                                       <span class="p">[],</span> <span class="n">kw_dict</span><span class="p">)</span>
                        <span class="n">required_passthrough</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;:</span><span class="si">{</span><span class="n">kw_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;:</span><span class="si">{</span><span class="n">kw_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>

                <span class="k">if</span> <span class="n">required_passthrough</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_passthrough</span><span class="p">:</span>
                        <span class="n">raise_passthrough_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">replaced_contents</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">evaluation_func</span><span class="p">(</span><span class="n">replaced_contents</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">replaced_contents</span>

                <span class="c1"># Replace escaped curly braces with curly braces</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">{&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">}&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExpansionGraph">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExpansionGraph">[docs]</a>
<span class="k">class</span> <span class="nc">ExpansionGraph</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing a graph of ExpansionNodes&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">str</span> <span class="o">=</span> <span class="n">in_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">ExpansionNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_str</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">in_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>

        <span class="n">opened</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">escaped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">ExpansionDelimiter</span><span class="o">.</span><span class="n">left</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">escaped</span><span class="p">:</span>
                <span class="n">opened</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">ExpansionDelimiter</span><span class="o">.</span><span class="n">right</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">opened</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">escaped</span><span class="p">:</span>
                <span class="n">left_idx</span> <span class="o">=</span> <span class="n">opened</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">right_idx</span> <span class="o">=</span> <span class="n">i</span>

                <span class="n">cur_match</span> <span class="o">=</span> <span class="n">ExpansionNode</span><span class="p">(</span><span class="n">left_idx</span><span class="p">,</span> <span class="n">right_idx</span><span class="p">)</span>
                <span class="n">cur_match</span><span class="o">.</span><span class="n">add_children</span><span class="p">(</span><span class="n">children</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
                <span class="n">cur_match</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="n">left_idx</span><span class="p">:</span><span class="n">right_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Define contents</span>
                <span class="n">cur_match</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opened</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_match</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">add_children</span><span class="p">(</span><span class="n">cur_match</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>  <span class="c1"># Don&#39;t expand across new lines</span>
                <span class="n">opened</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">ExpansionDelimiter</span><span class="o">.</span><span class="n">escape</span><span class="p">:</span>
                <span class="n">escaped</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">escaped</span><span class="p">:</span>
                <span class="n">escaped</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opened</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">add_children</span><span class="p">(</span><span class="n">children</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

<div class="viewcode-block" id="ExpansionGraph.walk">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExpansionGraph.walk">[docs]</a>
    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a DFS walk of the nodes in the graph</span>

<span class="sd">        Args:</span>
<span class="sd">            in_node (ExpansionNode): node to begin the walk from, if not set uses self.root</span>

<span class="sd">        Yields:</span>
<span class="sd">            (ExpansionNode): nodes following a DFS traversal of the graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur_node</span> <span class="o">=</span> <span class="n">in_node</span>
        <span class="k">if</span> <span class="n">cur_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cur_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">in_node</span><span class="o">=</span><span class="n">child</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">cur_node</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing string: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>



<div class="viewcode-block" id="ExpansionDict">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExpansionDict">[docs]</a>
<span class="k">class</span> <span class="nc">ExpansionDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span></div>



<div class="viewcode-block" id="Expander">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander">[docs]</a>
<span class="k">class</span> <span class="nc">Expander</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class that will track and expand keyword arguments</span>

<span class="sd">    This class will track variables and their definitions, to allow for</span>
<span class="sd">    expansion within string.</span>

<span class="sd">    The variables can come from workspace variables, software stack variables,</span>
<span class="sd">    and experiment variables.</span>

<span class="sd">    Additionally, math will be evaluated as part of expansion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">experiment_set</span><span class="p">,</span> <span class="n">no_expand_vars</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_expand_vars</span> <span class="o">=</span> <span class="n">no_expand_vars</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_set</span> <span class="o">=</span> <span class="n">experiment_set</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_application_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workload_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_application_namespace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workload_namespace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_namespace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env_namespace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_application_input_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workload_input_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_license_input_dir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_application_run_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workload_run_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_run_dir</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Expander.set_no_expand_vars">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander.set_no_expand_vars">[docs]</a>
    <span class="k">def</span> <span class="nf">set_no_expand_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_expand_vars</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_expand_vars</span> <span class="o">=</span> <span class="n">no_expand_vars</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="Expander.copy">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Expander</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_set</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">application_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_application_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">application_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workload_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workload_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_workload_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">workload_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workload_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">experiment_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">application_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_namespace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_application_namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_name</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_namespace</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workload_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workload_namespace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_workload_namespace</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application_name</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">workload_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workload_namespace</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">experiment_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_namespace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_namespace</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application_name</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">workload_name</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_namespace</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">env_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_namespace</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">env_name</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">workload_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env_namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_namespace</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">env_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_path</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">env_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">application_input_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_input_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_application_input_dir</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">application_input_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_input_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workload_input_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workload_input_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_workload_input_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">workload_input_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workload_input_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">license_input_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_license_input_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_license_input_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">license_input_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_license_input_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">application_run_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_run_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_application_run_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">application_run_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_run_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workload_run_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workload_run_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_workload_run_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">workload_run_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workload_run_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">experiment_run_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_run_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_run_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">experiment_run_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_run_dir</span>

<div class="viewcode-block" id="Expander.expand_lists">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander.expand_lists">[docs]</a>
    <span class="k">def</span> <span class="nf">expand_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Expand a variable into a list if possible</span>

<span class="sd">        If expanding a variable would generate a list, this function will</span>
<span class="sd">        return a list. If any error case happens, this function will return</span>
<span class="sd">        the unmodified input value.</span>

<span class="sd">        NOTE: This function is generally called early in the expansion. This allows</span>
<span class="sd">        lists to be generated before rendering experiments, but does not support</span>
<span class="sd">        pulling a list from a different experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">math_ast</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;eval&#39;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">math_ast</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">var</span>
        <span class="k">except</span> <span class="n">MathEvaluationError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">var</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">var</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">var</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">var</span></div>


<div class="viewcode-block" id="Expander.expand_var_name">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander.expand_var_name">[docs]</a>
    <span class="k">def</span> <span class="nf">expand_var_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">extra_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_passthrough</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a variable name to an expansion string, and expand it</span>

<span class="sd">        Take a variable name (var) and convert it to an expansion string by</span>
<span class="sd">        calling the expansion_str function. Pass the expansion string into</span>
<span class="sd">        expand_var, and return the result.</span>

<span class="sd">        Args:</span>
<span class="sd">            var_name: String name of variable to expand</span>
<span class="sd">            extra_vars: Variable definitions to use with highest precedence</span>
<span class="sd">            allow_passthrough: Whether the string is allowed to have keywords</span>
<span class="sd">                               after expansion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_str</span><span class="p">(</span><span class="n">var_name</span><span class="p">),</span>
                               <span class="n">extra_vars</span><span class="o">=</span><span class="n">extra_vars</span><span class="p">,</span>
                               <span class="n">allow_passthrough</span><span class="o">=</span><span class="n">allow_passthrough</span><span class="p">)</span></div>


<div class="viewcode-block" id="Expander.expand_var">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander.expand_var">[docs]</a>
    <span class="k">def</span> <span class="nf">expand_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">extra_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_passthrough</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform expansion of a string</span>

<span class="sd">        Expand a string by building up a dict of all</span>
<span class="sd">        expansion variables.</span>

<span class="sd">        Args:</span>
<span class="sd">            var: String variable to expand</span>
<span class="sd">            extra_vars: Variable definitions to use with highest precedence</span>
<span class="sd">            allow_passthrough: Whether the string is allowed to have keywords</span>
<span class="sd">                               after expansion</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">passthrough_setting</span> <span class="o">=</span> <span class="n">allow_passthrough</span>

        <span class="c1"># If disable_passthrough is set, override allow_passthrough from caller</span>
        <span class="k">if</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;config:disable_passthrough&#39;</span><span class="p">):</span>
            <span class="n">passthrough_setting</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;BEGINNING OF EXPAND_VAR STACK ON </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span>
        <span class="k">if</span> <span class="n">extra_vars</span><span class="p">:</span>
            <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">expansions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_vars</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_partial_expand</span><span class="p">(</span><span class="n">expansions</span><span class="p">,</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">),</span>
                                         <span class="n">allow_passthrough</span><span class="o">=</span><span class="n">passthrough_setting</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">RamblePassthroughError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">passthrough_setting</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RambleSyntaxError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Encountered a passthrough error while expanding </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;END OF EXPAND_VAR STACK </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Expander.evaluate_predicate">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander.evaluate_predicate">[docs]</a>
    <span class="k">def</span> <span class="nf">evaluate_predicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_str</span><span class="p">,</span> <span class="n">extra_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate a predicate by expanding and evaluating math contained in a string</span>

<span class="sd">        Args:</span>
<span class="sd">            in_str: String representing predicate that should be evaluated</span>
<span class="sd">            extra_vars: Variable definitions to use with highest precedence</span>

<span class="sd">        Returns:</span>
<span class="sd">            boolean: True or False, based on the evaluation of in_str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">evaluated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_var</span><span class="p">(</span><span class="n">in_str</span><span class="p">,</span> <span class="n">extra_vars</span><span class="o">=</span><span class="n">extra_vars</span><span class="p">,</span> <span class="n">allow_passthrough</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s1">&#39;Logical compute failed to return a string&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">evaluated</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">evaluated</span> <span class="o">==</span> <span class="s1">&#39;False&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;When evaluating </span><span class="si">{</span><span class="n">in_str</span><span class="si">}</span><span class="s1">, evaluate_predicate returned &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;a non-boolean string: &quot;</span><span class="si">{</span><span class="n">evaluated</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Expander.expansion_str">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander.expansion_str">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">expansion_str</span><span class="p">(</span><span class="n">in_str</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ExpansionDelimiter</span><span class="o">.</span><span class="n">left</span><span class="si">}{</span><span class="n">in_str</span><span class="si">}{</span><span class="n">ExpansionDelimiter</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s1">&#39;</span></div>


    <span class="k">def</span> <span class="nf">_partial_expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expansion_vars</span><span class="p">,</span> <span class="n">in_str</span><span class="p">,</span> <span class="n">allow_passthrough</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform expansion of a string with some variables</span>

<span class="sd">        args:</span>
<span class="sd">          expansion_vars (dict): Variables to perform expansion with</span>
<span class="sd">          in_str (str): Input template string to expand</span>
<span class="sd">          allow_passthrough (bool): Define if variables are allowed to passthrough</span>
<span class="sd">                                    without being expanded.</span>

<span class="sd">        returns:</span>
<span class="sd">          in_str (str): Expanded version of input string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">in_str</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">str_graph</span> <span class="o">=</span> <span class="n">ExpansionGraph</span><span class="p">(</span><span class="n">in_str</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">str_graph</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>
                <span class="n">node</span><span class="o">.</span><span class="n">define_value</span><span class="p">(</span><span class="n">expansion_vars</span><span class="p">,</span>
                                  <span class="n">allow_passthrough</span><span class="o">=</span><span class="n">allow_passthrough</span><span class="p">,</span>
                                  <span class="n">expansion_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_partial_expand</span><span class="p">,</span>
                                  <span class="n">evaluation_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">perform_math_eval</span><span class="p">,</span>
                                  <span class="n">no_expand_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_no_expand_vars</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">str_graph</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">in_str</span><span class="p">)</span>

<div class="viewcode-block" id="Expander.perform_math_eval">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander.perform_math_eval">[docs]</a>
    <span class="k">def</span> <span class="nf">perform_math_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attempt to evaluate in_str</span>

<span class="sd">        Args:</span>
<span class="sd">            in_str (str): string representing math to attempt to evaluate</span>

<span class="sd">        Returns:</span>
<span class="sd">            (str) either the evaluation of in_str (if successful) or in_str</span>
<span class="sd">            unmodified (if unsuccessful)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">math_ast</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">in_str</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;eval&#39;</span><span class="p">)</span>
            <span class="n">out_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">math_ast</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out_str</span>
        <span class="k">except</span> <span class="n">MathEvaluationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;   Math input is: &quot;</span><span class="si">{</span><span class="n">in_str</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">in_str</span></div>


<div class="viewcode-block" id="Expander.eval_math">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.Expander.eval_math">[docs]</a>
    <span class="k">def</span> <span class="nf">eval_math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate math from parsing the AST</span>

<span class="sd">        Does not assume a specific type of operands.</span>
<span class="sd">        Some operators will generate floating point, while</span>
<span class="sd">        others will generate integers (if the inputs are integers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Num</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ast_num</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ast_constant</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ast_name</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="c1"># TODO: Remove when we drop support for 3.6</span>
        <span class="c1"># DEPRECATED: Remove due to python 3.8</span>
        <span class="c1"># See: https://docs.python.org/3/library/ast.html#node-classes</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">s</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ast_attr</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_comparisons</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_bool_op</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_binary_ops</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_unary_ops</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_function_call</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">MathEvaluationError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unsupported math AST node </span><span class="si">{</span><span class="n">node_type</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                                      <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="vm">__dict__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


    <span class="c1"># Ast logic helper methods</span>
    <span class="k">def</span> <span class="nf">__raise_syntax_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">node_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">RambleSyntaxError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Syntax error while processing </span><span class="si">{</span><span class="n">node_type</span><span class="si">}</span><span class="s1"> node:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="vm">__dict__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ast_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a number node in the ast&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">n</span>

    <span class="k">def</span> <span class="nf">_ast_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a constant node in the ast&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">_ast_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a name node in the ast&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="nf">_ast_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle an attribute node in the ast&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">):</span>
            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ast_attr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ast_name</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__raise_syntax_error</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">attr</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_eval_function_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a subset of function call nodes in the ast&quot;&quot;&quot;</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">keywords</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">arg</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">supported_scalar_function_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">supported_scalar_function_pointers</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">supported_list_function_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">supported_list_function_pointers</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s1">&#39;replace&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MathEvaluationError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Undefined function </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> used.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                      <span class="s1">&#39;returning unexapanded string&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_bool_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a boolean operator node in the ast&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">supported_math_operators</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">)]</span>

            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported operand type in boolean operator&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported boolean operator&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_comparisons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a comparison node in the ast&quot;&quot;&quot;</span>

        <span class="c1"># Extract In nodes, and call their helper</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">ops</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">In</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_comp_in</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1"># Try to evaluate the comparison logic, if not return the node as is.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cur_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>

            <span class="n">op</span> <span class="o">=</span> <span class="n">supported_math_operators</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="n">cur_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">comparators</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">cur_left</span><span class="p">,</span> <span class="n">cur_right</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">ops</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cur_left</span> <span class="o">=</span> <span class="n">cur_right</span>
                <span class="k">for</span> <span class="n">comp</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">ops</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">comparators</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="n">supported_math_operators</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">comp</span><span class="p">)]</span>
                    <span class="n">cur_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>

                    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">op</span><span class="p">(</span><span class="n">cur_left</span><span class="p">,</span> <span class="n">cur_right</span><span class="p">)</span>

                    <span class="n">cur_left</span> <span class="o">=</span> <span class="n">cur_right</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported operand type in binary comparison operator&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported binary comparison operator&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_comp_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle in nodes in the ast</span>

<span class="sd">        Perform extraction of `&lt;variable&gt; in &lt;experiment&gt;` syntax.</span>
<span class="sd">        Raises an exception if the experiment does not exist.</span>

<span class="sd">        Also, evaluated `&lt;value&gt; in [list, of, values]` syntax.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ast_name</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">comparators</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">):</span>
                <span class="n">namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">comparators</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_set</span><span class="o">.</span><span class="n">get_var_from_experiment</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">expansion_str</span><span class="p">(</span><span class="n">var_name</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">RambleSyntaxError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s1"> does not exist in: &#39;</span> <span class="o">+</span>
                                            <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__raise_syntax_error</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">val</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
            <span class="n">lhs_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>

            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">comparators</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
                        <span class="n">rhs_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lhs_value</span> <span class="o">==</span> <span class="n">rhs_value</span><span class="p">:</span>
                            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">found</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__raise_syntax_error</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_binary_ops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate binary operators in the ast</span>

<span class="sd">        Extract the binary operator, and evaluate it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">left_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
            <span class="n">right_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">supported_math_operators</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left_eval</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right_eval</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported operand type in binary operator&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">op</span><span class="p">(</span><span class="n">left_eval</span><span class="p">,</span> <span class="n">right_eval</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported operand type in binary operator&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported binary operator&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_unary_ops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate unary operators in the ast</span>

<span class="sd">        Extract the unary operator, and evaluate it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">operand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_math</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported operand type in unary operator&#39;</span><span class="p">)</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">supported_math_operators</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">op</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported operand type in unary operator&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Unsupported unary operator&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="raise_passthrough_error">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.raise_passthrough_error">[docs]</a>
<span class="k">def</span> <span class="nf">raise_passthrough_error</span><span class="p">(</span><span class="n">in_str</span><span class="p">,</span> <span class="n">out_str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raise an error when passthrough is disabled but variables are not all expanded&quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expansion stack errors: attempted to expand &#39;</span>
                 <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">in_str</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  As: </span><span class="si">{</span><span class="n">out_str</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">RamblePassthroughError</span><span class="p">(</span><span class="s1">&#39;Error Stack:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;Input: &quot;</span><span class="si">{</span><span class="n">in_str</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;Output: &quot;</span><span class="si">{</span><span class="n">out_str</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ExpanderError">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExpanderError">[docs]</a>
<span class="k">class</span> <span class="nc">ExpanderError</span><span class="p">(</span><span class="n">ramble</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">RambleError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when an error happens within an expander&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="MathEvaluationError">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.MathEvaluationError">[docs]</a>
<span class="k">class</span> <span class="nc">MathEvaluationError</span><span class="p">(</span><span class="n">ExpanderError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when an error happens while evaluating math during</span>
<span class="sd">    expansion</span>
<span class="sd">    &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="RambleSyntaxError">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.RambleSyntaxError">[docs]</a>
<span class="k">class</span> <span class="nc">RambleSyntaxError</span><span class="p">(</span><span class="n">ExpanderError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when a syntax error happens within variable definitions&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="RamblePassthroughError">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.RamblePassthroughError">[docs]</a>
<span class="k">class</span> <span class="nc">RamblePassthroughError</span><span class="p">(</span><span class="n">ExpanderError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when passthrough is disabled and variables fail to expand&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="ApplicationNotDefinedError">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ApplicationNotDefinedError">[docs]</a>
<span class="k">class</span> <span class="nc">ApplicationNotDefinedError</span><span class="p">(</span><span class="n">ExpanderError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when an application is not defined properly&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="WorkloadNotDefinedError">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.WorkloadNotDefinedError">[docs]</a>
<span class="k">class</span> <span class="nc">WorkloadNotDefinedError</span><span class="p">(</span><span class="n">ExpanderError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when a workload is not defined properly&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="ExperimentNotDefinedError">
<a class="viewcode-back" href="../../ramble.html#ramble.expander.ExperimentNotDefinedError">[docs]</a>
<span class="k">class</span> <span class="nc">ExperimentNotDefinedError</span><span class="p">(</span><span class="n">ExpanderError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when an experiment is not defined properly&quot;&quot;&quot;</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Google LLC.
      <span class="lastupdated">Last updated on Feb 28, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>