<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ramble.workspace.workspace &mdash; Ramble 0.3.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=e259d695"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
          </a>
              <div class="version">
                0.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ramble.html">ramble package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration_files.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workspace.html">Ramble Workspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workspace_config.html">Workspace Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../success_criteria.html">Success Criteria</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/GoogleCloudPlatform/ramble#contributing">Contributing Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_guides.html">Developer Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/spack/spack">Spack</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Ramble</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ramble.workspace.workspace</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ramble.workspace.workspace</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2022-2023 Google LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 &lt;LICENSE-APACHE or</span>
<span class="c1"># https://www.apache.org/licenses/LICENSE-2.0&gt; or the MIT license</span>
<span class="c1"># &lt;LICENSE-MIT or https://opensource.org/licenses/MIT&gt;, at your</span>
<span class="c1"># option. This file may not be copied, modified, or distributed</span>
<span class="c1"># except according to those terms.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">import</span> <span class="nn">llnl.util.filesystem</span> <span class="k">as</span> <span class="nn">fs</span>
<span class="kn">import</span> <span class="nn">llnl.util.tty</span> <span class="k">as</span> <span class="nn">tty</span>
<span class="kn">import</span> <span class="nn">llnl.util.tty.log</span> <span class="k">as</span> <span class="nn">log</span>

<span class="kn">import</span> <span class="nn">ramble.config</span>
<span class="kn">import</span> <span class="nn">ramble.paths</span>
<span class="kn">import</span> <span class="nn">ramble.util.path</span>
<span class="kn">import</span> <span class="nn">ramble.error</span>
<span class="kn">import</span> <span class="nn">ramble.repository</span>
<span class="kn">import</span> <span class="nn">ramble.spack_runner</span>
<span class="kn">import</span> <span class="nn">ramble.experiment_set</span>
<span class="kn">import</span> <span class="nn">ramble.context</span>
<span class="kn">import</span> <span class="nn">ramble.util.web</span>
<span class="kn">import</span> <span class="nn">ramble.fetch_strategy</span>
<span class="kn">import</span> <span class="nn">ramble.util.install_cache</span>
<span class="kn">import</span> <span class="nn">ramble.success_criteria</span>
<span class="kn">import</span> <span class="nn">ramble.keywords</span>
<span class="kn">import</span> <span class="nn">ramble.software_environments</span>
<span class="kn">from</span> <span class="nn">ramble.mirror</span> <span class="kn">import</span> <span class="n">MirrorStats</span>

<span class="kn">import</span> <span class="nn">spack.util.spack_yaml</span> <span class="k">as</span> <span class="nn">syaml</span>
<span class="kn">import</span> <span class="nn">spack.util.spack_json</span> <span class="k">as</span> <span class="nn">sjson</span>
<span class="kn">from</span> <span class="nn">spack.util.executable</span> <span class="kn">import</span> <span class="n">CommandNotFoundError</span><span class="p">,</span> <span class="n">which</span>
<span class="kn">import</span> <span class="nn">spack.util.url</span> <span class="k">as</span> <span class="nn">url_util</span>
<span class="kn">import</span> <span class="nn">spack.util.web</span> <span class="k">as</span> <span class="nn">web_util</span>

<span class="kn">import</span> <span class="nn">ramble.schema.workspace</span>
<span class="kn">import</span> <span class="nn">ramble.schema.applications</span>
<span class="kn">import</span> <span class="nn">ramble.schema.merged</span>

<span class="kn">import</span> <span class="nn">ramble.util.lock</span> <span class="k">as</span> <span class="nn">lk</span>
<span class="kn">from</span> <span class="nn">ramble.util.path</span> <span class="kn">import</span> <span class="n">substitute_path_variables</span>
<span class="kn">from</span> <span class="nn">ramble.util.spec_utils</span> <span class="kn">import</span> <span class="n">specs_equiv</span>
<span class="kn">import</span> <span class="nn">ramble.util.hashing</span>
<span class="kn">from</span> <span class="nn">ramble.namespace</span> <span class="kn">import</span> <span class="n">namespace</span>
<span class="kn">import</span> <span class="nn">ramble.util.matrices</span>
<span class="kn">import</span> <span class="nn">ramble.util.env</span>
<span class="kn">from</span> <span class="nn">ramble.util.logger</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="c1">#: Environment variable used to indicate the active workspace</span>
<span class="n">ramble_workspace_var</span> <span class="o">=</span> <span class="s1">&#39;RAMBLE_WORKSPACE&#39;</span>

<span class="c1">#: Currently activated workspace</span>
<span class="n">_active_workspace</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1">#: Subdirectory where workspace configs are stored</span>
<span class="n">workspace_config_path</span> <span class="o">=</span> <span class="s1">&#39;configs&#39;</span>

<span class="c1">#: Name of subdirectory within workspaces where logs are stored</span>
<span class="n">workspace_log_path</span> <span class="o">=</span> <span class="s1">&#39;logs&#39;</span>

<span class="c1">#: Name of subdirectory within workspaces where experiments are stored</span>
<span class="n">workspace_experiment_path</span> <span class="o">=</span> <span class="s1">&#39;experiments&#39;</span>

<span class="c1">#: Name of subdirectory within workspaces where input files are stored</span>
<span class="n">workspace_input_path</span> <span class="o">=</span> <span class="s1">&#39;inputs&#39;</span>

<span class="c1">#: Name of subdirectory within workspaces where software environment</span>
<span class="c1">#: are stored</span>
<span class="n">workspace_software_path</span> <span class="o">=</span> <span class="s1">&#39;software&#39;</span>

<span class="c1">#: Name of the subdirectory where workspace archives are stored</span>
<span class="n">workspace_archive_path</span> <span class="o">=</span> <span class="s1">&#39;archive&#39;</span>

<span class="c1">#: Name of the subdirectory where shared/sourale files are stored</span>
<span class="n">workspace_shared_path</span> <span class="o">=</span> <span class="s1">&#39;shared&#39;</span>

<span class="c1">#: Name of the subdirectory where shared/sourale files are stored</span>
<span class="n">workspace_shared_license_path</span> <span class="o">=</span> <span class="s1">&#39;licenses&#39;</span>

<span class="c1">#: regex for validating workspace names</span>
<span class="n">valid_workspace_name_re</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^\w[\w-]*$&#39;</span>

<span class="c1">#: Config schema for application files</span>
<span class="n">applications_schema</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">schema</span>

<span class="c1">#: Extension for template files</span>
<span class="n">workspace_template_extension</span> <span class="o">=</span> <span class="s1">&#39;.tpl&#39;</span>

<span class="c1">#: Directory name for auxiliary software files</span>
<span class="n">auxiliary_software_dir_name</span> <span class="o">=</span> <span class="s1">&#39;auxiliary_software_files&#39;</span>

<span class="c1">#: Config file information for workspaces.</span>
<span class="c1">#: Keys are filenames, values are dictionaries describing the config files.</span>
<span class="n">config_schema</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">workspace</span><span class="o">.</span><span class="n">schema</span>
<span class="n">config_section</span> <span class="o">=</span> <span class="s1">&#39;workspace&#39;</span>
<span class="n">config_file_name</span> <span class="o">=</span> <span class="s1">&#39;ramble.yaml&#39;</span>


<div class="viewcode-block" id="default_config_yaml">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.default_config_yaml">[docs]</a>
<span class="k">def</span> <span class="nf">default_config_yaml</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;default ramble.yaml file to put in new workspaces&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2"># This is a ramble workspace config file.</span>
<span class="s2">#</span>
<span class="s2"># It describes the experiments, the software stack</span>
<span class="s2"># and all variables required for ramble to configure</span>
<span class="s2"># experiments.</span>
<span class="s2"># As an example, experiments can be defined as follows.</span>
<span class="s2"># applications:</span>
<span class="s2">#   variables:</span>
<span class="s2">#     processes_per_node: &#39;30&#39;</span>
<span class="s2">#   hostname: # Application name, as seen in `ramble list`</span>
<span class="s2">#     variables:</span>
<span class="s2">#       iterations: &#39;5&#39;</span>
<span class="s2">#     workloads:</span>
<span class="s2">#       serial: # Workload name, as seen in `ramble info &lt;app&gt;`</span>
<span class="s2">#         variables:</span>
<span class="s2">#           type: &#39;test&#39;</span>
<span class="s2">#         experiments:</span>
<span class="s2">#           single_node: # Arbitrary experiment name</span>
<span class="s2">#             variables:</span>
<span class="s2">#               n_ranks: &#39;</span><span class="si">{processes_per_node}</span><span class="s2">&#39;</span>

<span class="s2">ramble:</span>
<span class="s2">  env_vars:</span>
<span class="s2">    set:</span>
<span class="s2">      OMP_NUM_THREADS: &#39;</span><span class="si">{n_threads}</span><span class="s2">&#39;</span>
<span class="s2">  variables:</span>
<span class="s2">    mpi_command: mpirun -n </span><span class="si">{n_ranks}</span>
<span class="s2">    batch_submit: &#39;</span><span class="si">{execute_experiment}</span><span class="s2">&#39;</span>
<span class="s2">    processes_per_node: -1</span>
<span class="s2">  applications: </span><span class="si">{}</span>
<span class="s2">  spack:</span>
<span class="s2">    concretized: false</span>
<span class="s2">    packages: </span><span class="si">{}</span>
<span class="s2">    environments: </span><span class="si">{}</span>
<span class="s2">&quot;&quot;&quot;</span></div>



<span class="n">workspace_all_experiments_file</span> <span class="o">=</span> <span class="s1">&#39;all_experiments&#39;</span>

<span class="n">workspace_execution_template</span> <span class="o">=</span> <span class="s1">&#39;execute_experiment&#39;</span> <span class="o">+</span> \
    <span class="n">workspace_template_extension</span>

<span class="n">template_execute_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2"># This is a template execution script for</span>
<span class="s2"># running the execute pipeline.</span>
<span class="s2">#</span>
<span class="s2"># Variables surrounded by curly braces will be expanded</span>
<span class="s2"># when generating a specific execution script.</span>
<span class="s2"># Some example variables are:</span>
<span class="s2">#   - experiment_run_dir (Will be replaced with the experiment directory)</span>
<span class="s2">#   - command (Will be replaced with the command to run the experiment)</span>
<span class="s2">#   - log_dir (Will be replaced with the logs directory)</span>
<span class="s2">#   - experiment_name (Will be replaced with the name of the experiment)</span>
<span class="s2">#   - workload_run_dir (Will be replaced with the directory of the workload</span>
<span class="s2">#   - application_name (Will be repalced with the name of the application)</span>
<span class="s2">#   - n_nodes (Will be replaced with the required number of nodes)</span>
<span class="s2">#   Any experiment parameters will be available as variables as well.</span>

<span class="s2">cd &quot;</span><span class="si">{experiment_run_dir}</span><span class="s2">&quot;</span>

<span class="si">{command}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">#: Name of lockfile within a workspace</span>
<span class="n">lockfile_name</span> <span class="o">=</span> <span class="s1">&#39;ramble.lock&#39;</span>


<div class="viewcode-block" id="valid_workspace_name">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.valid_workspace_name">[docs]</a>
<span class="k">def</span> <span class="nf">valid_workspace_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">valid_workspace_name_re</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="validate_workspace_name">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.validate_workspace_name">[docs]</a>
<span class="k">def</span> <span class="nf">validate_workspace_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_workspace_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Validation failed for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span>
            <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;: names must start with a letter, and only contain &quot;</span>
            <span class="s2">&quot;letters, numbers, _, and -.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span></div>



<div class="viewcode-block" id="activate">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.activate">[docs]</a>
<span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Activate a workspace.</span>

<span class="sd">    To activate a workspace, we add its configuration scope to the</span>
<span class="sd">    existing Ramble configuration, and we set active to the current</span>
<span class="sd">    workspace.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        ws (Workspace): the workspace to activate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_active_workspace</span>

    <span class="c1"># Fail early to avoid ending in an invalid state</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">Workspace</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`ws` should be of type </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

    <span class="c1"># Check if we need to reinitialize the store due to pushing the configuration</span>
    <span class="c1"># below.</span>
    <span class="n">prepare_config_scope</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using workspace &#39;</span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Do this last, because setting up the config must succeed first.</span>
    <span class="n">_active_workspace</span> <span class="o">=</span> <span class="n">ws</span></div>



<div class="viewcode-block" id="deactivate">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.deactivate">[docs]</a>
<span class="k">def</span> <span class="nf">deactivate</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Undo any configuration settings modified by ``activate()``.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_active_workspace</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_active_workspace</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deactivated workspace &#39;</span><span class="si">{</span><span class="n">_active_workspace</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="n">deactivate_config_scope</span><span class="p">(</span><span class="n">_active_workspace</span><span class="p">)</span>

    <span class="n">_active_workspace</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="prepare_config_scope">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.prepare_config_scope">[docs]</a>
<span class="k">def</span> <span class="nf">prepare_config_scope</span><span class="p">(</span><span class="n">workspace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add workspace&#39;s scope to the global configuration search path.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="n">workspace</span><span class="o">.</span><span class="n">config_scopes</span><span class="p">():</span>
        <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">push_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span></div>



<div class="viewcode-block" id="deactivate_config_scope">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.deactivate_config_scope">[docs]</a>
<span class="k">def</span> <span class="nf">deactivate_config_scope</span><span class="p">(</span><span class="n">workspace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove any scopes from workspace from the global config path.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="n">workspace</span><span class="o">.</span><span class="n">config_scopes</span><span class="p">():</span>
        <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">remove_scope</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="all_workspace_names">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.all_workspace_names">[docs]</a>
<span class="k">def</span> <span class="nf">all_workspace_names</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List the names of workspaces that currently exist.&quot;&quot;&quot;</span>
    <span class="c1"># just return empty if the workspace path does not exist.  A read-only</span>
    <span class="c1"># operation like list should not try to create a directory.</span>
    <span class="n">wspath</span> <span class="o">=</span> <span class="n">get_workspace_path</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wspath</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">wspath</span><span class="p">))</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
        <span class="n">configured</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">yaml_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_root</span><span class="p">(</span><span class="n">candidate</span><span class="p">),</span>
                                 <span class="n">workspace_config_path</span><span class="p">,</span>
                                 <span class="n">config_file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">):</span>
            <span class="n">configured</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">valid_workspace_name</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span> <span class="ow">and</span> <span class="n">configured</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">names</span></div>



<div class="viewcode-block" id="all_workspaces">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.all_workspaces">[docs]</a>
<span class="k">def</span> <span class="nf">all_workspaces</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generator for all named workspaces.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">all_workspace_names</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">read</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="active_workspace">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.active_workspace">[docs]</a>
<span class="k">def</span> <span class="nf">active_workspace</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the active workspace when there is any&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_active_workspace</span></div>



<div class="viewcode-block" id="get_workspace_path">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.get_workspace_path">[docs]</a>
<span class="k">def</span> <span class="nf">get_workspace_path</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns current directory of ramble-managed workspaces&quot;&quot;&quot;</span>
    <span class="n">path_in_config</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;config:workspace_dirs&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path_in_config</span><span class="p">:</span>
        <span class="c1"># command above should have worked, so if it doesn&#39;t, error out:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s1">&#39;No config:workspace_dirs setting found in configuration!&#39;</span><span class="p">)</span>

    <span class="n">wspath</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">canonicalize_path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path_in_config</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">wspath</span></div>



<span class="k">def</span> <span class="nf">_root</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Non-validating version of root(), to be used internally.&quot;&quot;&quot;</span>
    <span class="n">wspath</span> <span class="o">=</span> <span class="n">get_workspace_path</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wspath</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<div class="viewcode-block" id="root">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.root">[docs]</a>
<span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the root directory for a workspace by name.&quot;&quot;&quot;</span>
    <span class="n">validate_workspace_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_root</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="license_path">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.license_path">[docs]</a>
<span class="k">def</span> <span class="nf">license_path</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the root directory for a workspace by name.&quot;&quot;&quot;</span>
    <span class="n">shared_license_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workspace_shared_path</span><span class="p">,</span> <span class="n">workspace_shared_license_path</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">shared_license_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_root</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="exists">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.exists">[docs]</a>
<span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether a workspace with this name exists or not.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_workspace_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>



<div class="viewcode-block" id="active">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.active">[docs]</a>
<span class="k">def</span> <span class="nf">active</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;True if the named workspace is active.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_active_workspace</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="n">_active_workspace</span><span class="o">.</span><span class="n">name</span></div>



<div class="viewcode-block" id="config_file">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.config_file">[docs]</a>
<span class="k">def</span> <span class="nf">config_file</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the path to a workspace&#39;s ramble.yaml&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_workspace_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">workspace_config_path</span><span class="p">,</span> <span class="n">config_file_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="template_path">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.template_path">[docs]</a>
<span class="k">def</span> <span class="nf">template_path</span><span class="p">(</span><span class="n">ws_path</span><span class="p">,</span> <span class="n">requested_template_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the path to a workspace&#39;s template file&quot;&quot;&quot;</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ws_path</span><span class="p">,</span> <span class="n">workspace_config_path</span><span class="p">)</span>
    <span class="n">template_file</span> <span class="o">=</span> <span class="n">requested_template_name</span> <span class="o">+</span> <span class="n">workspace_template_extension</span>
    <span class="n">template_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">template_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">template_path</span></div>



<div class="viewcode-block" id="all_template_paths">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.all_template_paths">[docs]</a>
<span class="k">def</span> <span class="nf">all_template_paths</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns (abs) path to available template files in the workspace&quot;&quot;&quot;</span>
    <span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">workspace_config_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">workspace_template_extension</span><span class="p">):</span>
            <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">templates</span></div>



<div class="viewcode-block" id="is_workspace_dir">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.is_workspace_dir">[docs]</a>
<span class="k">def</span> <span class="nf">is_workspace_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether a directory contains a ramble workspace.&quot;&quot;&quot;</span>
    <span class="n">ret_val</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ret_val</span><span class="p">:</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="n">ret_val</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">workspace_config_path</span><span class="p">,</span> <span class="n">config_file_name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ret_val</span></div>



<div class="viewcode-block" id="create">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.create">[docs]</a>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a named workspace in Ramble&quot;&quot;&quot;</span>
    <span class="n">validate_workspace_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">RambleWorkspaceError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;: workspace already exists&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">root</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>



<div class="viewcode-block" id="config_dict">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.config_dict">[docs]</a>
<span class="k">def</span> <span class="nf">config_dict</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the configuration scope section out of a ramble.yaml&quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">first_existing</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">,</span> <span class="n">ramble</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">workspace</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yaml_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>



<div class="viewcode-block" id="get_workspace">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.get_workspace">[docs]</a>
<span class="k">def</span> <span class="nf">get_workspace</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cmd_name</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used by commands to get the active workspace.</span>

<span class="sd">    This first checks for a ``workspace`` argument, then looks at the</span>
<span class="sd">    ``active`` workspace.  We check args first because Ramble&#39;s</span>
<span class="sd">    subcommand arguments are parsed *after* the ``-s`` and ``-D``</span>
<span class="sd">    arguments to ``ramble``.  So there may be a ``workspace``</span>
<span class="sd">    argument that is *not* the active workspace, and we give it</span>
<span class="sd">    precedence.</span>

<span class="sd">    This is used by a number of commands for determining whether there is</span>
<span class="sd">    an active workspace.</span>

<span class="sd">    If a workspace is not found *and* is required, print an error</span>
<span class="sd">    message that says the calling command *needs* an active</span>
<span class="sd">    workspace.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        args (ramble.namespace): argparse namespace with command arguments</span>
<span class="sd">        cmd_name (str): name of calling command</span>
<span class="sd">        required (bool): if ``True``, raise an exception when no workspace</span>
<span class="sd">                         is found; if ``False``, just return ``None``</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Workspace): if there is an arg or active workspace</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;In get_workspace()&#39;</span><span class="p">)</span>

    <span class="n">workspace</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;workspace&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">workspace</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">workspace</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">read</span><span class="p">(</span><span class="n">workspace</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_workspace_dir</span><span class="p">(</span><span class="n">workspace</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">workspace</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RambleWorkspaceError</span><span class="p">(</span><span class="s1">&#39;no workspace in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">workspace</span><span class="p">)</span>

    <span class="c1"># try the active workspace. This is set by find_workspace (above)</span>
    <span class="k">if</span> <span class="n">_active_workspace</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_active_workspace</span>
    <span class="c1"># elif not required:</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">die</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;`ramble </span><span class="si">{</span><span class="n">cmd_name</span><span class="si">}</span><span class="s1">` requires a workspace&#39;</span><span class="p">,</span>
            <span class="s1">&#39;activate a workspace first:&#39;</span><span class="p">,</span>
            <span class="s1">&#39;    ramble workspace activate WRKSPC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;or use:&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;    ramble -w WRKSPC </span><span class="si">{</span><span class="n">cmd_name</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Workspace">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace">[docs]</a>
<span class="k">class</span> <span class="nc">Workspace</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing a working directory for workload</span>
<span class="sd">    experiments</span>

<span class="sd">    Each workspace must have a config directory, that contains 2</span>
<span class="sd">    files by default.</span>

<span class="sd">    - ramble.yaml</span>
<span class="sd">    - execute_experiment.tpl</span>

<span class="sd">    The ramble.yaml file is the overall configuration file for</span>
<span class="sd">    this workspace. It defines all experiments, variables, and</span>
<span class="sd">    the entire software stack.</span>

<span class="sd">    The execute_experiment.tpl file is a template script that</span>
<span class="sd">    constants the blueprints for running each experiment.</span>
<span class="sd">    There are several ramble language features that can be used</span>
<span class="sd">    within the script, to help it render properly for all</span>
<span class="sd">    experiments.</span>

<span class="sd">    Each file with the suffix of .tpl will be expanded into the</span>
<span class="sd">    experiment directory, with the .tpl suffix removed.</span>

<span class="sd">    Directories will be created for each experiment, when the</span>
<span class="sd">    relevant phase of the application is executed. The workspace</span>
<span class="sd">    provides a self contained execution environment where experiments</span>
<span class="sd">    can be performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">inventory_file_name</span> <span class="o">=</span> <span class="s1">&#39;ramble_inventory.json&#39;</span>
    <span class="n">hash_file_name</span> <span class="o">=</span> <span class="s1">&#39;workspace_hash.sha256&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;In workspace init. Root = </span><span class="si">{</span><span class="n">root</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">canonicalize_path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txlock</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">Lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transaction_lock_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dry_run</span> <span class="o">=</span> <span class="n">dry_run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">always_print_foms</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ConfigScope</span><span class="p">(</span><span class="s1">&#39;workspace&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_templates</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auxiliary_software_files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">software_mirror_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_mirror_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror_existed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">software_mirror_stats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_mirror_stats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_mirror_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">software_mirror_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_software_environments</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_inventory</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;experiments&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;versions&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="kn">from</span> <span class="nn">ramble.main</span> <span class="kn">import</span> <span class="n">get_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_inventory</span><span class="p">[</span><span class="s1">&#39;versions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ramble&#39;</span><span class="p">,</span>
                <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">get_version</span><span class="p">(),</span>
                <span class="s1">&#39;digest&#39;</span><span class="p">:</span> <span class="n">ramble</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">hashing</span><span class="o">.</span><span class="n">hash_string</span><span class="p">(</span><span class="n">get_version</span><span class="p">()),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="kn">from</span> <span class="nn">ramble.spack_runner</span> <span class="kn">import</span> <span class="n">SpackRunner</span><span class="p">,</span> <span class="n">RunnerError</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">runner</span> <span class="o">=</span> <span class="n">SpackRunner</span><span class="p">()</span>
            <span class="n">spack_version</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hash_inventory</span><span class="p">[</span><span class="s1">&#39;versions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;spack&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">spack_version</span><span class="p">,</span>
                    <span class="s1">&#39;digest&#39;</span><span class="p">:</span> <span class="n">ramble</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">hashing</span><span class="o">.</span><span class="n">hash_string</span><span class="p">(</span><span class="n">spack_version</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">RunnerError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workspace_hash</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">specs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">install_cache</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">install_cache</span><span class="o">.</span><span class="n">SetCache</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_results</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">success_list</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">success_criteria</span><span class="o">.</span><span class="n">ScopedCriteriaList</span><span class="p">()</span>

        <span class="c1"># Key for each application config should be it&#39;s filepath</span>
        <span class="c1"># Format for an application config should be:</span>
        <span class="c1">#  {</span>
        <span class="c1">#     &#39;filename&#39;: &lt;filename&gt;,</span>
        <span class="c1">#     &#39;path&#39;: &lt;filepath&gt;,</span>
        <span class="c1">#     &#39;raw_yaml&#39;: &lt;raw_yaml&gt;,</span>
        <span class="c1">#     &#39;yaml&#39;: &lt;yaml&gt;</span>
        <span class="c1">#  }</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application_configs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">experiments_script</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">()</span>

        <span class="c1"># Create a logger to redirect certain prints from screen to log file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">tty</span><span class="o">.</span><span class="n">debug_level</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_re_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reinitialize the workspace object if it has been written (this</span>
<span class="sd">           may not be true if the workspace was just created in this running</span>
<span class="sd">           instance of ramble).&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]):</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Create the workspace config section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span><span class="p">[</span><span class="s1">&#39;workspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file_path</span><span class="p">,</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file_path</span><span class="p">,</span>
            <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">config_schema</span><span class="p">,</span>
            <span class="s1">&#39;section_filename&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file_path</span><span class="p">,</span>
            <span class="s1">&#39;raw_yaml&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;yaml&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span>

        <span class="n">keywords</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">keywords</span>

        <span class="n">read_default</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">read_default</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_config</span><span class="p">(</span><span class="n">config_section</span><span class="p">,</span> <span class="n">default_config_yaml</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_read_config</span><span class="p">(</span><span class="n">config_section</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="n">read_default_script</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ext_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">workspace_template_extension</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">workspace_template_extension</span><span class="p">):</span>
                    <span class="n">read_default_script</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">template_name</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="n">ext_len</span><span class="p">]</span>
                    <span class="n">template_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">keywords</span><span class="o">.</span><span class="n">is_reserved</span><span class="p">(</span><span class="n">template_name</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">RambleInvalidTemplateNameError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;Template file </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> results in a &#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;template name of </span><span class="si">{</span><span class="n">template_name</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="o">+</span> <span class="s1">&#39; which is reserved by ramble.&#39;</span>
                        <span class="p">)</span>

                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_read_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auxiliary_software_dir</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auxiliary_software_dir</span><span class="p">):</span>
                    <span class="n">aux_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auxiliary_software_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">aux_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_read_auxiliary_software_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">read_default_script</span><span class="p">:</span>
            <span class="n">template_name</span> <span class="o">=</span> <span class="n">workspace_execution_template</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="n">ext_len</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">template_execute_script</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_read_all_application_configs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_read_all_application_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path_replacements</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;workspace&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
            <span class="s1">&#39;workspace_config&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span>
        <span class="p">}</span>
        <span class="n">ramble_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_workspace_dict</span><span class="p">()[</span><span class="n">namespace</span><span class="o">.</span><span class="n">ramble</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">application_dir</span> <span class="ow">in</span> <span class="n">ramble_dict</span><span class="p">:</span>
            <span class="n">app_dirs</span> <span class="o">=</span> <span class="n">ramble_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">application_dir</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">raw_dir</span> <span class="ow">in</span> <span class="n">app_dirs</span><span class="p">:</span>
                <span class="n">app_dir</span> <span class="o">=</span> <span class="n">substitute_path_variables</span><span class="p">(</span><span class="n">raw_dir</span><span class="p">,</span>
                                                    <span class="n">path_replacements</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">app_dir</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">RambleMissingApplicationDirError</span><span class="p">(</span>
                        <span class="s1">&#39;Application directory </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span>
                        <span class="o">%</span> <span class="n">app_dir</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">filenames</span><span class="p">)</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">app_dir</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.yaml&#39;</span><span class="p">):</span>
                            <span class="n">full_path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_read_application_config</span><span class="p">(</span>
                                    <span class="n">full_path</span><span class="p">,</span>
                                    <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_application_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">raw_yaml</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read an application configuration file&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_configs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">application_configs</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
                <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">applications_schema</span><span class="p">,</span>
                <span class="s1">&#39;raw_yaml&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;yaml&#39;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">}</span>

        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_configs</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_yaml</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">raw_yaml</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">raw_yaml</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read configuration file&quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_yaml</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">raw_yaml</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_deprecated</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;yaml&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_check_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trap and warn (or error) on deprecated configuration settings</span>
<span class="sd">        in the workspace config.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">error_sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deprecated_sections</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">deprecated_sections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Your workspace configuration contains deprecated sections:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">deprecated_sections</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;     </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Please see the current workspace documentation and update&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;to ensure your workspace continues to function properly&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_sections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Your workspace configuration contains invalid sections:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">deprecated_sections</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;     </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s1">&#39;Please update to the latest format.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">raw_yaml</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">raw_yaml</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;yaml&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_yaml</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">])</span>
            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;raw_yaml&#39;</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_read_yaml</span><span class="p">(</span><span class="n">raw_yaml</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;raw_yaml&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;yaml&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_yaml</span><span class="p">(</span><span class="n">f</span><span class="p">,</span>
                                                            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_read_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a template file&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_templates</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;contents&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
            <span class="s1">&#39;digest&#39;</span><span class="p">:</span> <span class="n">ramble</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">hashing</span><span class="o">.</span><span class="n">hash_string</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_read_auxiliary_software_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read an auxiliary software file for generated software directories&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auxiliary_software_files</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>

<div class="viewcode-block" id="Workspace.write">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write an in-memory workspace to its location on disk.&quot;&quot;&quot;</span>

        <span class="c1"># Ensure required directory structure exists</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auxiliary_software_dir</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_dir</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">software_dir</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shared_dir</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shared_license_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_config</span><span class="p">(</span><span class="n">config_section</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_templates</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_write_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update YAML config file for this workspace, based on</span>
<span class="sd">        changes and write it&quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span>

        <span class="n">changed</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">yaml_equivalent</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;raw_yaml&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;yaml&#39;</span><span class="p">])</span>
        <span class="n">written</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">changed</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">written</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;raw_yaml&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;yaml&#39;</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">write_tmp_and_move</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">_write_yaml</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;yaml&#39;</span><span class="p">],</span> <span class="n">f</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_write_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write all templates out to workspace&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_templates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">template_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;contents&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="Workspace.clear">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.clear">[docs]</a>
    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application_configs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_active</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># previously active environment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specs</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Workspace.extract_success_criteria">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.extract_success_criteria">[docs]</a>
    <span class="k">def</span> <span class="nf">extract_success_criteria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract success citeria, and inject it into the scoped list</span>

<span class="sd">        Extract success criteria from a contents dictionary, and inject it into</span>
<span class="sd">        the scoped success list within the right scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_list</span><span class="o">.</span><span class="n">flush_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">success</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39; ---- Found success in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">scope</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">success</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39; ---- Adding criteria </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">success_list</span><span class="o">.</span><span class="n">add_criteria</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="o">**</span><span class="n">conf</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.all_specs">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.all_specs">[docs]</a>
    <span class="k">def</span> <span class="nf">all_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">ramble.spec</span>

        <span class="n">specs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">app</span><span class="p">,</span> <span class="n">workloads</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_applications</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">workload</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_workloads</span><span class="p">(</span><span class="n">workloads</span><span class="p">):</span>
                <span class="n">app_spec</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">Spec</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
                <span class="n">app_spec</span><span class="o">.</span><span class="n">workloads</span><span class="p">[</span><span class="n">workload</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">app_spec</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">specs</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_experiments_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">workspace_all_experiments_file</span><span class="p">)</span>

<div class="viewcode-block" id="Workspace.build_experiment_set">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.build_experiment_set">[docs]</a>
    <span class="k">def</span> <span class="nf">build_experiment_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an experiment set representing this workspace&quot;&quot;&quot;</span>

        <span class="n">experiment_set</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">experiment_set</span><span class="o">.</span><span class="n">ExperimentSet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">experiment_set</span><span class="o">.</span><span class="n">set_base_var</span><span class="p">(</span><span class="s1">&#39;experiments_file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_experiments_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">workloads</span><span class="p">,</span> <span class="n">application_context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_applications</span><span class="p">():</span>
            <span class="n">experiment_set</span><span class="o">.</span><span class="n">set_application_context</span><span class="p">(</span><span class="n">application_context</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">experiments</span><span class="p">,</span> <span class="n">workload_context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_workloads</span><span class="p">(</span><span class="n">workloads</span><span class="p">):</span>
                <span class="n">experiment_set</span><span class="o">.</span><span class="n">set_workload_context</span><span class="p">(</span><span class="n">workload_context</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">experiment_context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_experiments</span><span class="p">(</span><span class="n">experiments</span><span class="p">):</span>
                    <span class="n">experiment_set</span><span class="o">.</span><span class="n">set_experiment_context</span><span class="p">(</span><span class="n">experiment_context</span><span class="p">)</span>

        <span class="n">experiment_set</span><span class="o">.</span><span class="n">build_experiment_chains</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">experiment_set</span></div>


<div class="viewcode-block" id="Workspace.all_applications">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.all_applications">[docs]</a>
    <span class="k">def</span> <span class="nf">all_applications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterator over applications</span>

<span class="sd">        Returns application, context</span>
<span class="sd">        where context contains the platform level variables that</span>
<span class="sd">        should be applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ws_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_workspace_dict</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; With ws dict: </span><span class="si">{</span><span class="n">ws_dict</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Iterate over applications in ramble.yaml first</span>
        <span class="n">app_dict</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;applications&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">application</span><span class="p">,</span> <span class="n">contents</span> <span class="ow">in</span> <span class="n">app_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">application_context</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">create_context_from_dict</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">extract_success_criteria</span><span class="p">(</span><span class="s1">&#39;application&#39;</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">contents</span><span class="p">,</span> <span class="n">application_context</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  Iterating over configs in directories...&#39;</span><span class="p">)</span>
        <span class="c1"># Iterate over applications defined in application directories</span>
        <span class="c1"># files after the ramble.yaml file is complete</span>
        <span class="k">for</span> <span class="n">app_conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_configs</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_application_dict_config</span><span class="p">(</span><span class="n">app_conf</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">application</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No applications in config file </span><span class="si">{</span><span class="n">app_conf</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">app_dict</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">application</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">application</span><span class="p">,</span> <span class="n">contents</span> <span class="ow">in</span> <span class="n">app_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">application_context</span> <span class="o">=</span> \
                    <span class="n">ramble</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">create_context_from_dict</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">extract_success_criteria</span><span class="p">(</span><span class="s1">&#39;application&#39;</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">contents</span><span class="p">,</span> <span class="n">application_context</span></div>


<div class="viewcode-block" id="Workspace.all_workloads">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.all_workloads">[docs]</a>
    <span class="k">def</span> <span class="nf">all_workloads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterator over workloads in an application dict</span>

<span class="sd">        Returns workload, context</span>
<span class="sd">        where context contains the application level variables that</span>
<span class="sd">        should be applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">workload</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">application</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;No workloads in application&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">workloads</span> <span class="o">=</span> <span class="n">application</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">workload</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">workload</span><span class="p">,</span> <span class="n">contents</span> <span class="ow">in</span> <span class="n">workloads</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">workload_context</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">create_context_from_dict</span><span class="p">(</span><span class="n">workload</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">extract_success_criteria</span><span class="p">(</span><span class="s1">&#39;workload&#39;</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">contents</span><span class="p">,</span> <span class="n">workload_context</span></div>


<div class="viewcode-block" id="Workspace.all_experiments">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.all_experiments">[docs]</a>
    <span class="k">def</span> <span class="nf">all_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workload</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterator over experiments in a workload dict</span>

<span class="sd">        Returns experiment, context</span>
<span class="sd">        Where context contains the workload level variables that</span>
<span class="sd">        should be applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">experiment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">workload</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;No experiments in workload&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">experiments</span> <span class="o">=</span> <span class="n">workload</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">experiment</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">contents</span> <span class="ow">in</span> <span class="n">experiments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">experiment_context</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">create_context_from_dict</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">extract_success_criteria</span><span class="p">(</span><span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">contents</span><span class="p">,</span> <span class="n">experiment_context</span></div>


<div class="viewcode-block" id="Workspace.external_spack_env">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.external_spack_env">[docs]</a>
    <span class="k">def</span> <span class="nf">external_spack_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_name</span><span class="p">):</span>
        <span class="n">env_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">software_environments</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="n">env_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">external_env</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env_context</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">env_context</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">external_env</span><span class="p">]</span></div>


<div class="viewcode-block" id="Workspace.concretize">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.concretize">[docs]</a>
    <span class="k">def</span> <span class="nf">concretize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spack_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spack_dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;concretized&#39;</span> <span class="ow">in</span> <span class="n">spack_dict</span> <span class="ow">and</span> <span class="n">spack_dict</span><span class="p">[</span><span class="s1">&#39;concretized&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">RambleWorkspaceError</span><span class="p">(</span><span class="s1">&#39;Cannot conretize an &#39;</span> <span class="o">+</span>
                                       <span class="s1">&#39;already concretized &#39;</span> <span class="o">+</span>
                                       <span class="s1">&#39;workspace&#39;</span><span class="p">)</span>

        <span class="n">spack_dict</span> <span class="o">=</span> <span class="n">syaml</span><span class="o">.</span><span class="n">syaml_dict</span><span class="p">()</span>
        <span class="n">spack_dict</span><span class="p">[</span><span class="s1">&#39;concretized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">packages</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spack_dict</span> <span class="ow">or</span> \
                <span class="ow">not</span> <span class="n">spack_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">packages</span><span class="p">]:</span>
            <span class="n">spack_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">packages</span><span class="p">]</span> <span class="o">=</span> <span class="n">syaml</span><span class="o">.</span><span class="n">syaml_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">environments</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spack_dict</span> <span class="ow">or</span> \
                <span class="ow">not</span> <span class="n">spack_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">environments</span><span class="p">]:</span>
            <span class="n">spack_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">environments</span><span class="p">]</span> <span class="o">=</span> <span class="n">syaml</span><span class="o">.</span><span class="n">syaml_dict</span><span class="p">()</span>

        <span class="n">packages_dict</span> <span class="o">=</span> <span class="n">spack_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">packages</span><span class="p">]</span>
        <span class="n">environments_dict</span> <span class="o">=</span> <span class="n">spack_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">environments</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">software_environments</span> <span class="o">=</span> \
            <span class="n">ramble</span><span class="o">.</span><span class="n">software_environments</span><span class="o">.</span><span class="n">SoftwareEnvironments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">experiment_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_experiment_set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">exp</span><span class="p">,</span> <span class="n">app_inst</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">experiment_set</span><span class="o">.</span><span class="n">all_experiments</span><span class="p">():</span>
            <span class="n">app_inst</span><span class="o">.</span><span class="n">build_modifier_instances</span><span class="p">()</span>
            <span class="n">env_name_str</span> <span class="o">=</span> <span class="n">app_inst</span><span class="o">.</span><span class="n">expander</span><span class="o">.</span><span class="n">expansion_str</span><span class="p">(</span><span class="n">ramble</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">env_name</span><span class="p">)</span>
            <span class="n">env_name</span> <span class="o">=</span> <span class="n">app_inst</span><span class="o">.</span><span class="n">expander</span><span class="o">.</span><span class="n">expand_var</span><span class="p">(</span><span class="n">env_name_str</span><span class="p">)</span>

            <span class="n">compiler_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">app_inst</span><span class="o">.</span><span class="n">default_compilers</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">mod_inst</span> <span class="ow">in</span> <span class="n">app_inst</span><span class="o">.</span><span class="n">_modifier_instances</span><span class="p">:</span>
                <span class="n">compiler_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mod_inst</span><span class="o">.</span><span class="n">default_compilers</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">compiler_dict</span> <span class="ow">in</span> <span class="n">compiler_dicts</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">comp</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">compiler_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">comp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">packages_dict</span><span class="p">:</span>
                        <span class="n">packages_dict</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">syaml</span><span class="o">.</span><span class="n">syaml_dict</span><span class="p">()</span>
                        <span class="n">packages_dict</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;spack_spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spack_spec&#39;</span><span class="p">]</span>
                        <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;spack:packages:</span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s1">:spack_spec:</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;spack_spec&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                          <span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_file_config_scope_name</span><span class="p">())</span>
                        <span class="k">if</span> <span class="s1">&#39;compiler_spec&#39;</span> <span class="ow">in</span> <span class="n">info</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;compiler_spec&#39;</span><span class="p">]:</span>
                            <span class="n">packages_dict</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;compiler_spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;compiler_spec&#39;</span><span class="p">]</span>
                            <span class="n">config_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;spack:packages:</span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s1">:&#39;</span> <span class="o">+</span> \
                                <span class="sa">f</span><span class="s1">&#39;compiler_spec:</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;compiler_spec&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_file_config_scope_name</span><span class="p">())</span>
                        <span class="k">if</span> <span class="s1">&#39;compiler&#39;</span> <span class="ow">in</span> <span class="n">info</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">]:</span>
                            <span class="n">packages_dict</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;compiler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">]</span>
                            <span class="n">config_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;spack:packages:</span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s1">:&#39;</span> <span class="o">+</span> \
                                <span class="sa">f</span><span class="s1">&#39;compiler:</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;compiler&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_file_config_scope_name</span><span class="p">())</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">specs_equiv</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">packages_dict</span><span class="p">[</span><span class="n">comp</span><span class="p">]):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Spec 1: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Spec 2: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">packages_dict</span><span class="p">[</span><span class="n">comp</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">RambleConflictingDefinitionError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;Compiler </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s1"> defined in multiple conflicting ways&#39;</span>
                        <span class="p">)</span>

            <span class="k">if</span> <span class="n">env_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">environments_dict</span><span class="p">:</span>
                <span class="n">environments_dict</span><span class="p">[</span><span class="n">env_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">syaml</span><span class="o">.</span><span class="n">syaml_dict</span><span class="p">()</span>
                <span class="n">environments_dict</span><span class="p">[</span><span class="n">env_name</span><span class="p">][</span><span class="n">namespace</span><span class="o">.</span><span class="n">packages</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Trying to define packages for </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">app_packages</span> <span class="o">=</span> <span class="n">environments_dict</span><span class="p">[</span><span class="n">env_name</span><span class="p">][</span><span class="n">namespace</span><span class="o">.</span><span class="n">packages</span><span class="p">]</span>

            <span class="n">software_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">app_inst</span><span class="o">.</span><span class="n">software_specs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">mod_inst</span> <span class="ow">in</span> <span class="n">app_inst</span><span class="o">.</span><span class="n">_modifier_instances</span><span class="p">:</span>
                <span class="n">software_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mod_inst</span><span class="o">.</span><span class="n">software_specs</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">software_dict</span> <span class="ow">in</span> <span class="n">software_dicts</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spec_name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">software_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    Found spec: </span><span class="si">{</span><span class="n">spec_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">spec_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">packages_dict</span><span class="p">:</span>
                        <span class="n">packages_dict</span><span class="p">[</span><span class="n">spec_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">syaml</span><span class="o">.</span><span class="n">syaml_dict</span><span class="p">()</span>
                        <span class="n">packages_dict</span><span class="p">[</span><span class="n">spec_name</span><span class="p">][</span><span class="s1">&#39;spack_spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spack_spec&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s1">&#39;compiler_spec&#39;</span> <span class="ow">in</span> <span class="n">info</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;compiler_spec&#39;</span><span class="p">]:</span>
                            <span class="n">packages_dict</span><span class="p">[</span><span class="n">spec_name</span><span class="p">][</span><span class="s1">&#39;compiler_spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;compiler_spec&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s1">&#39;compiler&#39;</span> <span class="ow">in</span> <span class="n">info</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">]:</span>
                            <span class="n">packages_dict</span><span class="p">[</span><span class="n">spec_name</span><span class="p">][</span><span class="s1">&#39;compiler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">]</span>

                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">specs_equiv</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">packages_dict</span><span class="p">[</span><span class="n">spec_name</span><span class="p">]):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Spec 1: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Spec 2: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">packages_dict</span><span class="p">[</span><span class="n">spec_name</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">RambleConflictingDefinitionError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;Package </span><span class="si">{</span><span class="n">spec_name</span><span class="si">}</span><span class="s1"> defined in multiple conflicting ways&#39;</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">spec_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">app_packages</span><span class="p">:</span>
                        <span class="n">app_packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec_name</span><span class="p">)</span>

        <span class="n">spack_dict</span><span class="p">[</span><span class="s1">&#39;concretized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span><span class="s1">&#39;spack&#39;</span><span class="p">,</span> <span class="n">spack_dict</span><span class="p">,</span>
                                           <span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_file_config_scope_name</span><span class="p">())</span>

        <span class="k">return</span></div>


<div class="viewcode-block" id="Workspace.write_json_results">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.write_json_results">[docs]</a>
    <span class="k">def</span> <span class="nf">write_json_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;results.json&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">sjson</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out_file</span></div>


<div class="viewcode-block" id="Workspace.default_results">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.default_results">[docs]</a>
    <span class="k">def</span> <span class="nf">default_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_hash</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;workspace_hash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_hash</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_file_name</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;workspace_hash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="s1">&#39;workspace_hash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unknown..&quot;</span>

        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;experiments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="Workspace.append_result">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.append_result">[docs]</a>
    <span class="k">def</span> <span class="nf">append_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_results</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;experiments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.simlink_result">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.simlink_result">[docs]</a>
    <span class="k">def</span> <span class="nf">simlink_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename_base</span><span class="p">,</span> <span class="n">latest_base</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create simlink of result file so that results.latest.txt always points</span>
<span class="sd">        to the most recent analysis. This clobbers the existing link</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">)</span>
        <span class="n">latest_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">latest_base</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">latest_file</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">latest_file</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="n">latest_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.dump_results">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.dump_results">[docs]</a>
    <span class="k">def</span> <span class="nf">dump_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_formats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write out result file in desired format</span>

<span class="sd">        This attempts to avoid the loss of previous results data by appending</span>
<span class="sd">        the datetime to the filename, but is willing to clobber the file</span>
<span class="sd">        results.latest.&lt;extension&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">results_written</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_string</span><span class="p">()</span>
        <span class="n">inner_delim</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
        <span class="n">filename_base</span> <span class="o">=</span> <span class="s1">&#39;results&#39;</span> <span class="o">+</span> <span class="n">inner_delim</span> <span class="o">+</span> <span class="n">dt</span>
        <span class="n">latest_base</span> <span class="o">=</span> <span class="s1">&#39;results&#39;</span> <span class="o">+</span> <span class="n">inner_delim</span> <span class="o">+</span> <span class="s1">&#39;latest&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;text&#39;</span> <span class="ow">in</span> <span class="n">output_formats</span><span class="p">:</span>

            <span class="n">file_extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
            <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">)</span>

            <span class="n">results_written</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;From Workspace: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (hash: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;workspace_hash&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;experiments&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;experiments&#39;</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Experiment </span><span class="si">%s</span><span class="s1"> figures of merit:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                                <span class="n">exp</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Status = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                                <span class="n">exp</span><span class="p">[</span><span class="s1">&#39;RAMBLE_STATUS&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">exp</span><span class="p">[</span><span class="s1">&#39;RAMBLE_STATUS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">always_print_foms</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">exp</span><span class="p">[</span><span class="s1">&#39;CONTEXTS&#39;</span><span class="p">]:</span>
                                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">%s</span><span class="s1"> figures of merit:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                                        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                                <span class="k">for</span> <span class="n">fom</span> <span class="ow">in</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;foms&#39;</span><span class="p">]:</span>
                                    <span class="n">name</span> <span class="o">=</span> <span class="n">fom</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                                    <span class="k">if</span> <span class="n">fom</span><span class="p">[</span><span class="s1">&#39;origin_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;modifier&#39;</span><span class="p">:</span>
                                        <span class="n">delim</span> <span class="o">=</span> <span class="s1">&#39;::&#39;</span>
                                        <span class="n">mod</span> <span class="o">=</span> <span class="n">fom</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span>
                                        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fom</span><span class="p">[</span><span class="s1">&#39;origin_type&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">delim</span><span class="si">}{</span><span class="n">mod</span><span class="si">}{</span><span class="n">delim</span><span class="si">}{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

                                    <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span>
                                                             <span class="n">fom</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                                                             <span class="n">fom</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
                                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;No results to write&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">simlink_result</span><span class="p">(</span><span class="n">filename_base</span><span class="p">,</span> <span class="n">latest_base</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;json&#39;</span> <span class="ow">in</span> <span class="n">output_formats</span><span class="p">:</span>
            <span class="n">file_extension</span> <span class="o">=</span> <span class="s1">&#39;.json&#39;</span>
            <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">)</span>
            <span class="n">results_written</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">sjson</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simlink_result</span><span class="p">(</span><span class="n">filename_base</span><span class="p">,</span> <span class="n">latest_base</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;yaml&#39;</span> <span class="ow">in</span> <span class="n">output_formats</span><span class="p">:</span>
            <span class="n">file_extension</span> <span class="o">=</span> <span class="s1">&#39;.yaml&#39;</span>
            <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">)</span>
            <span class="n">results_written</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">syaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simlink_result</span><span class="p">(</span><span class="n">filename_base</span><span class="p">,</span> <span class="n">latest_base</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">results_written</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s1">&#39;Results were not written.&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">all_msg</span><span class="p">(</span><span class="s1">&#39;Results are written to:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">out_file</span> <span class="ow">in</span> <span class="n">results_written</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">all_msg</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">out_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filename_base</span></div>


<div class="viewcode-block" id="Workspace.run_experiments">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.run_experiments">[docs]</a>
    <span class="k">def</span> <span class="nf">run_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">experiment_script</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/all_experiments&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CommandNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RambleWorkspaceError</span><span class="p">(</span><span class="s1">&#39;Cannot find `all_experiments` in workspace root.&#39;</span><span class="p">)</span>

        <span class="n">experiment_script</span><span class="p">()</span></div>


<div class="viewcode-block" id="Workspace.create_mirror">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.create_mirror">[docs]</a>
    <span class="k">def</span> <span class="nf">create_mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mirror_root</span><span class="p">):</span>
        <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">url_util</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">mirror_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror_path</span> <span class="o">=</span> <span class="n">url_util</span><span class="o">.</span><span class="n">local_file_path</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror_existed</span> <span class="o">=</span> <span class="n">web_util</span><span class="o">.</span><span class="n">url_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mirror_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_mirror_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mirror_path</span><span class="p">,</span> <span class="s1">&#39;inputs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">software_mirror_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mirror_path</span><span class="p">,</span> <span class="s1">&#39;software&#39;</span><span class="p">)</span>
        <span class="n">mirror_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mirror_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_mirror_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">software_mirror_path</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">mirror_dirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">subdir</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fs</span><span class="o">.</span><span class="n">mkdirp</span><span class="p">(</span><span class="n">subdir</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ramble</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">MirrorError</span><span class="p">(</span>
                        <span class="s2">&quot;Cannot create directory &#39;</span><span class="si">%s</span><span class="s2">&#39;:&quot;</span> <span class="o">%</span> <span class="n">subdir</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">software_mirror_stats</span> <span class="o">=</span> <span class="n">MirrorStats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_mirror_stats</span> <span class="o">=</span> <span class="n">MirrorStats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_mirror_cache</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">caches</span><span class="o">.</span><span class="n">MirrorCache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_mirror_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">software_mirror_cache</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">caches</span><span class="o">.</span><span class="n">MirrorCache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">software_mirror_path</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latest_archive_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archive_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_archive</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latest_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_latest_archive&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latest_archive</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latest_archive</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archive_dir</span><span class="p">):</span>
            <span class="n">archive_dirs</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archive_dir</span><span class="p">):</span>
                <span class="n">archive_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archive_dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">archive_path</span><span class="p">):</span>
                    <span class="n">archive_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archive_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">archive_dirs</span><span class="p">:</span>
                <span class="n">latest_path</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">archive_dirs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_latest_archive</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">latest_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latest_archive</span>

        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="Workspace.date_string">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.date_string">[docs]</a>
    <span class="k">def</span> <span class="nf">date_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H.%M.%S&quot;</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">internal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this workspace is managed by Ramble.&quot;&quot;&quot;</span>
        <span class="n">wspath</span> <span class="o">=</span> <span class="n">get_workspace_path</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">wspath</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Human-readable representation of the workspace.</span>

<span class="sd">        The name of the workspace is the basename of its path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Location of the workspace&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if this workspace is currently active.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_active_workspace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="n">_active_workspace</span><span class="o">.</span><span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_transaction_lock_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The location of the lock file used to synchronize multiple</span>
<span class="sd">        processes updating the same workspace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;transaction_lock&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">experiment_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the experiment directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">workspace_experiment_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the input directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">workspace_input_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">software_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the software directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">workspace_software_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the logs directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">workspace_log_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the configuration file directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">workspace_config_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auxiliary_software_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the auxiliary software files directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span><span class="p">,</span> <span class="n">auxiliary_software_dir_name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the configuration file directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span><span class="p">,</span> <span class="n">config_file_name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">archive_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the archive directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">workspace_archive_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shared_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the shared directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">workspace_shared_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shared_license_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to the shared license directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shared_dir</span><span class="p">,</span> <span class="n">workspace_shared_license_path</span><span class="p">)</span>

<div class="viewcode-block" id="Workspace.template_path">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.template_path">[docs]</a>
    <span class="k">def</span> <span class="nf">template_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_templates</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span>
                                <span class="n">workspace_template_extension</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Workspace.all_templates">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.all_templates">[docs]</a>
    <span class="k">def</span> <span class="nf">all_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterator over each template in the workspace&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_templates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">conf</span></div>


<div class="viewcode-block" id="Workspace.all_auxiliary_software_files">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.all_auxiliary_software_files">[docs]</a>
    <span class="k">def</span> <span class="nf">all_auxiliary_software_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterator over each file in $workspace/configs/auxiliary_software_files&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auxiliary_software_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Workspace.included_config_scopes">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.included_config_scopes">[docs]</a>
    <span class="k">def</span> <span class="nf">included_config_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of included configuration scopes from the environment.</span>

<span class="sd">        Scopes are listed in the YAML file in order from highest to</span>
<span class="sd">        lowest precedence, so configuration from earlier scope will take</span>
<span class="sd">        precedence over later ones.</span>

<span class="sd">        This routine returns them in the order they should be pushed onto</span>
<span class="sd">        the internal scope stack (so, in reverse, from lowest to highest).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scopes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># load config scopes added via &#39;include:&#39;, in reverse so that</span>
        <span class="c1"># highest-precedence scopes are last.</span>
        <span class="n">includes</span> <span class="o">=</span> <span class="n">config_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span><span class="p">[</span><span class="s1">&#39;workspace&#39;</span><span class="p">][</span><span class="s1">&#39;yaml&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;include&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">config_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">includes</span><span class="p">)):</span>
            <span class="c1"># allow paths to contain ramble config/environment variables, etc.</span>
            <span class="n">config_path</span> <span class="o">=</span> <span class="n">substitute_path_variables</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>

            <span class="c1"># treat relative paths as relative to the environment</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
                <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
                <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">config_path</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
                <span class="c1"># directories are treated as regular ConfigScopes</span>
                <span class="n">config_name</span> <span class="o">=</span> <span class="s1">&#39;workspace:</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">config_path</span><span class="p">))</span>
                <span class="n">scope</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ConfigScope</span><span class="p">(</span><span class="n">config_name</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
                <span class="c1"># files are assumed to be SingleFileScopes</span>
                <span class="n">config_name</span> <span class="o">=</span> <span class="s1">&#39;workspace:</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
                <span class="n">scope</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">SingleFileScope</span><span class="p">(</span>
                    <span class="n">config_name</span><span class="p">,</span> <span class="n">config_path</span><span class="p">,</span> <span class="n">ramble</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">merged</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Detected </span><span class="si">{0}</span><span class="s1"> missing include path(s):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="s1">Please correct and try again.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scopes</span></div>


<div class="viewcode-block" id="Workspace.ws_file_config_scope_name">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.ws_file_config_scope_name">[docs]</a>
    <span class="k">def</span> <span class="nf">ws_file_config_scope_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the config scope of this workspace&#39;s config file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;workspace:</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_dir</span><span class="p">)</span></div>

        <span class="c1"># return &#39;ws:%s&#39; % self.name</span>

<div class="viewcode-block" id="Workspace.ws_file_config_scope">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.ws_file_config_scope">[docs]</a>
    <span class="k">def</span> <span class="nf">ws_file_config_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the configuration scope for the workspace&#39;s config file.&quot;&quot;&quot;</span>
        <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span><span class="p">[</span><span class="s1">&#39;workspace&#39;</span><span class="p">]</span>
        <span class="n">config_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_file_config_scope_name</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">SingleFileScope</span><span class="p">(</span>
            <span class="n">config_name</span><span class="p">,</span>
            <span class="n">section</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span>
            <span class="n">ramble</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">workspace</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
            <span class="p">[</span><span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">first_existing</span><span class="p">(</span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;raw_yaml&#39;</span><span class="p">],</span>
                                          <span class="n">ramble</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">workspace</span><span class="o">.</span><span class="n">keys</span><span class="p">)])</span></div>


<div class="viewcode-block" id="Workspace.config_scopes">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.config_scopes">[docs]</a>
    <span class="k">def</span> <span class="nf">config_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A list of all configuration scopes for this workspace.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">included_config_scopes</span><span class="p">()</span> <span class="o">+</span> \
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_file_config_scope</span><span class="p">()]</span> <span class="o">+</span> \
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">]</span></div>


<div class="viewcode-block" id="Workspace.destroy">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.destroy">[docs]</a>
    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove this workspace from Ramble entirely.&quot;&quot;&quot;</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_workspace_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span><span class="p">[</span><span class="s1">&#39;workspace&#39;</span><span class="p">][</span><span class="s1">&#39;yaml&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;workspace&#39;</span> \
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_sections</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_application_dict_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_configs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;yaml&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> \
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_configs</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="Workspace.is_concretized">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.is_concretized">[docs]</a>
    <span class="k">def</span> <span class="nf">is_concretized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spack_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spack_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;concretized&#39;</span> <span class="ow">in</span> <span class="n">spack_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">True</span> <span class="k">if</span> <span class="n">spack_dict</span><span class="p">[</span><span class="s1">&#39;concretized&#39;</span><span class="p">]</span>
                    <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


    <span class="k">def</span> <span class="nf">_get_workspace_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dict of a workspace section&quot;&quot;&quot;</span>
        <span class="n">workspace_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_workspace_dict</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">workspace_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">ramble</span><span class="p">][</span><span class="n">section</span><span class="p">]</span> \
            <span class="k">if</span> <span class="n">section</span> <span class="ow">in</span> \
            <span class="n">workspace_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">ramble</span><span class="p">]</span> <span class="k">else</span> <span class="n">syaml</span><span class="o">.</span><span class="n">syaml_dict</span><span class="p">()</span>

<div class="viewcode-block" id="Workspace.get_workspace_vars">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.get_workspace_vars">[docs]</a>
    <span class="k">def</span> <span class="nf">get_workspace_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dict of workspace variables&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;variables&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.get_workspace_env_vars">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.get_workspace_env_vars">[docs]</a>
    <span class="k">def</span> <span class="nf">get_workspace_env_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dict of workspace environment variables&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;env_vars&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.get_workspace_internals">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.get_workspace_internals">[docs]</a>
    <span class="k">def</span> <span class="nf">get_workspace_internals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dict of workspace internals&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="n">namespace</span><span class="o">.</span><span class="n">internals</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.get_workspace_modifiers">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.get_workspace_modifiers">[docs]</a>
    <span class="k">def</span> <span class="nf">get_workspace_modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dict of workspace modifiers&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;modifiers&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.get_workspace_zips">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.get_workspace_zips">[docs]</a>
    <span class="k">def</span> <span class="nf">get_workspace_zips</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dict of workspace zips&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;zips&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.get_spack_dict">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.get_spack_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">get_spack_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the spack dictionary for this workspace&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;spack&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.get_applications">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.get_applications">[docs]</a>
    <span class="k">def</span> <span class="nf">get_applications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the dictionary of applications&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Getting app dict.&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_workspace_dict</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">workspace_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_workspace_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">application</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">workspace_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">ramble</span><span class="p">]:</span>
            <span class="n">workspace_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">ramble</span><span class="p">][</span><span class="n">namespace</span><span class="o">.</span><span class="n">application</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">syaml</span><span class="o">.</span><span class="n">syaml_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">workspace_dict</span><span class="p">[</span><span class="n">namespace</span><span class="o">.</span><span class="n">ramble</span><span class="p">][</span><span class="n">namespace</span><span class="o">.</span><span class="n">application</span><span class="p">]</span></div>


<div class="viewcode-block" id="Workspace.write_transaction">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.write_transaction">[docs]</a>
    <span class="k">def</span> <span class="nf">write_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a write lock context manager for use in a `with` block.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">lk</span><span class="o">.</span><span class="n">WriteTransaction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txlock</span><span class="p">,</span> <span class="n">acquire</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_re_read</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_active</span> <span class="o">=</span> <span class="n">_active_workspace</span>
        <span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="n">deactivate</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_active</span><span class="p">:</span>
            <span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_previous_active</span><span class="p">)</span>

<div class="viewcode-block" id="Workspace.check_cache">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.check_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">check_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tupl</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_cache</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">tupl</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workspace.add_to_cache">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.Workspace.add_to_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">add_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tupl</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tupl</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="read">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.read">[docs]</a>
<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a workspace with the supplied name.&quot;&quot;&quot;</span>
    <span class="n">validate_workspace_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">RambleWorkspaceError</span><span class="p">(</span><span class="s2">&quot;no such workspace &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">root</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>



<div class="viewcode-block" id="yaml_equivalent">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.yaml_equivalent">[docs]</a>
<span class="k">def</span> <span class="nf">yaml_equivalent</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns whether two ramble yaml items are equivalent, including overrides</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_equiv_dict</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_equiv_list</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># it&#39;s a string</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="ow">and</span> <span class="n">first</span> <span class="o">==</span> <span class="n">second</span></div>



<span class="k">def</span> <span class="nf">_equiv_list</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns whether two ramble yaml lists are equivalent, including overrides</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">yaml_equivalent</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_equiv_dict</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns whether two ramble yaml dicts are equivalent, including overrides</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">same_values</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">yaml_equivalent</span><span class="p">(</span><span class="n">fv</span><span class="p">,</span> <span class="n">sv</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">fv</span><span class="p">,</span> <span class="n">sv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">second</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">same_keys_with_same_overrides</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">fk</span> <span class="o">==</span> <span class="n">sk</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fk</span><span class="p">,</span> <span class="s1">&#39;override&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="s1">&#39;override&#39;</span><span class="p">,</span>
                                                               <span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fk</span><span class="p">,</span> <span class="n">sk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">second</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">same_values</span> <span class="ow">and</span> <span class="n">same_keys_with_same_overrides</span>


<span class="k">def</span> <span class="nf">_read_yaml</span><span class="p">(</span><span class="n">str_or_file</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read YAML from a file for round-trip parsing.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">syaml</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="n">str_or_file</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">str_or_file</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">default_data</span> <span class="o">=</span> <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">default_data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_write_yaml</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">str_or_file</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write YAML to a file preserving comments and dict order.&quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">str_or_file</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ramble</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">syaml</span><span class="o">.</span><span class="n">dump_config</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">str_or_file</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<div class="viewcode-block" id="no_active_workspace">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.no_active_workspace">[docs]</a>
<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">no_active_workspace</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deactivate the active workspace for the duration of the context. Has no</span>
<span class="sd">       effect when there is no active workspace.&quot;&quot;&quot;</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">active_workspace</span><span class="p">()</span>
    <span class="n">env_var</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">ramble_workspace_var</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">env_var</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ramble_workspace_var</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ramble_workspace_var</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">deactivate</span><span class="p">()</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ws</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ramble_workspace_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_var</span>
            <span class="n">activate</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span></div>



<div class="viewcode-block" id="RambleWorkspaceError">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.RambleWorkspaceError">[docs]</a>
<span class="k">class</span> <span class="nc">RambleWorkspaceError</span><span class="p">(</span><span class="n">ramble</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">RambleError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Superclass for all errors to do with Ramble Workspaces&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="RambleInvalidTemplateNameError">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.RambleInvalidTemplateNameError">[docs]</a>
<span class="k">class</span> <span class="nc">RambleInvalidTemplateNameError</span><span class="p">(</span><span class="n">ramble</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">RambleError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error when an invalid template name is provided&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="RambleConflictingDefinitionError">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.RambleConflictingDefinitionError">[docs]</a>
<span class="k">class</span> <span class="nc">RambleConflictingDefinitionError</span><span class="p">(</span><span class="n">RambleWorkspaceError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error when conflicting software definitions are found&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="RambleMissingApplicationError">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.RambleMissingApplicationError">[docs]</a>
<span class="k">class</span> <span class="nc">RambleMissingApplicationError</span><span class="p">(</span><span class="n">RambleWorkspaceError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error when using an undefined application in an experiment</span>
<span class="sd">    specification&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="RambleMissingWorkloadError">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.RambleMissingWorkloadError">[docs]</a>
<span class="k">class</span> <span class="nc">RambleMissingWorkloadError</span><span class="p">(</span><span class="n">RambleWorkspaceError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error when using an undefined workload in an experiment</span>
<span class="sd">    specification&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="RambleMissingExperimentError">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.RambleMissingExperimentError">[docs]</a>
<span class="k">class</span> <span class="nc">RambleMissingExperimentError</span><span class="p">(</span><span class="n">RambleWorkspaceError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error when using an undefined experiment in an experiment</span>
<span class="sd">    specification&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="RambleMissingApplicationDirError">
<a class="viewcode-back" href="../../../ramble.workspace.html#ramble.workspace.RambleMissingApplicationDirError">[docs]</a>
<span class="k">class</span> <span class="nc">RambleMissingApplicationDirError</span><span class="p">(</span><span class="n">RambleWorkspaceError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error when using a non-existent application directory&quot;&quot;&quot;</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Google LLC.
      <span class="lastupdated">Last updated on Nov 23, 2023.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>