<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ramble Mirrors &mdash; Ramble 0.3.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=e259d695"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
          </a>
              <div class="version">
                0.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ramble.html">ramble package</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_files.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="workspace.html">Ramble Workspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="workspace_config.html">Workspace Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="success_criteria.html">Success Criteria</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="command_index.html">ramble</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-attributes">ramble attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-clean">ramble clean</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-commands">ramble commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-config">ramble config</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-debug">ramble debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-edit">ramble edit</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-flake8">ramble flake8</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-help">ramble help</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-info">ramble info</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-license">ramble license</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-list">ramble list</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-mirror">ramble mirror</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-mods">ramble mods</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-on">ramble on</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-repo">ramble repo</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-results">ramble results</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-software-definitions">ramble software-definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-unit-test">ramble unit-test</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html#ramble-workspace">ramble workspace</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/GoogleCloudPlatform/ramble#contributing">Contributing Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_guides.html">Developer Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/spack/spack">Spack</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ramble</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Ramble Mirrors</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mirror-config.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ramble-mirrors">
<span id="mirror-config"></span><h1>Ramble Mirrors<a class="headerlink" href="#ramble-mirrors" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">workspace</span> <span class="pre">setup</span></code> command can take a long time (or fail)
to run when an application’s input files are large or internet access
to input file URLs is slow or restricted. Since the setup command runs
<code class="docutils literal notranslate"><span class="pre">spack</span></code> to install software, downloading source tarballs or zip files
could have similar problems.</p>
<p>Another reason one might want to set up mirrors would be to ensure
reproducibility of results, since remote input and source files might change
without warning.</p>
<p>As a means to work around these issues on the software installation side,
Spack provides the <code class="docutils literal notranslate"><span class="pre">mirror</span></code> command, documented
[here](<a class="reference external" href="https://spack.readthedocs.io/en/latest/mirrors.html">https://spack.readthedocs.io/en/latest/mirrors.html</a>).</p>
<p>Ramble provides a similar <code class="docutils literal notranslate"><span class="pre">mirror</span></code> command, in order to find workload input files
locally first instead of in their default locations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">mirror</span></code> set of commands largely follow the same form as <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">mirror</span></code> commands
(<code class="docutils literal notranslate"><span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">set-url</span></code>, <code class="docutils literal notranslate"><span class="pre">remove</span></code>, <code class="docutils literal notranslate"><span class="pre">destroy</span></code>), with the exception of mirror creation.</p>
<p>Since Ramble input mirrors are intended to be used by applications, and applications are used
via Ramble workspaces, Ramble input mirrors are created via the <code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">workspace</span> <span class="pre">mirror</span></code>
command, documented below. This command creates both the ramble input file mirror and the
spack source archive mirror, both of which are automatically restricted to mirror only those
input files and packages required for the ramble applications used in the workspace.</p>
<p>Once ramble input and spack software mirrors have been created, the user wishing to use those
will then run both <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">mirror</span> <span class="pre">add</span> <span class="pre">SOFTWARE_MIRROR_URL</span></code> and <code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">mirror</span> <span class="pre">add</span> <span class="pre">INPUT_MIRROR_URL</span></code>.
The <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">mirror</span></code> commands, as described in the above documentation,
are also documented via <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">mirror</span> <span class="pre">-h</span></code>. Likewise, short descriptions of
<code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">mirror</span></code> commands can be found via <code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">mirror</span> <span class="pre">-h</span></code>.</p>
<section id="creating-ramble-mirrors">
<h2>Creating Ramble Mirrors<a class="headerlink" href="#creating-ramble-mirrors" title="Link to this heading"></a></h2>
<p>In an activated named or anonymous workspace (specified via the <code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">workspace</span> <span class="pre">-d</span></code> argument), write
a configuration for any applications and application experiment workloads you want to create
a mirror for.</p>
<p>Then run the following command to create input file and software mirrors:
.. code-block:: console</p>
<blockquote>
<div><p>$ ramble workspace [-d WORKSPACE_DIR] mirror create -d MIRROR_PATH</p>
</div></blockquote>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">MIRROR_PATH</span></code> argument is not optional, even though <code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">workspace</span> <span class="pre">mirror</span> <span class="pre">-h</span></code>
indicates that it is an optional argument. The path must be located on the local
filesystem.</p>
</section>
<section id="mirror-structure">
<h2>Mirror Structure<a class="headerlink" href="#mirror-structure" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">workspace</span> <span class="pre">create</span></code> creates ramble and spack mirrors with a structure
similar to the following, which uses a mirror of wrfv3 as an example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>workspace
<span class="go">├── inputs</span>
<span class="go">│   ├── _input-cache</span>
<span class="go">│   │   └── archive</span>
<span class="go">│   │       └── 19</span>
<span class="go">│   │           └── 1919a0e0499057c1a570619d069817022bae95b17cf1a52bdaa174f8e8d11508.tar.bz2</span>
<span class="go">│   └── wrfv3</span>
<span class="go">│       ├── bench_12km.tar.bz2</span>
<span class="go">│       └── bench_2.5km.tar.bz2</span>
<span class="go">└── software</span>
<span class="go">    ├── _source-cache</span>
<span class="go">    │   └── archive</span>
<span class="go">    │       ├── 1c</span>
<span class="go">    │       │   └── 1ce97f4fd09e440bdf00f67711b1c50439ac27595ea6796efbfb32e0b9a1f3e4</span>
<span class="go">    │       ├── 27</span>
<span class="go">    │       │   └── 27c7268f6c84b884d21e4afad0bab8554b06961cf4d6bfd7d0f5a457dcfdffb1</span>
<span class="go">    │       ├── a0</span>
<span class="go">    │       │   └── a04f5c425bedd262413ec88192a0f0896572cc38549de85ca120863c43df047a.tar.gz</span>
<span class="go">    │       └── c5</span>
<span class="go">    │           └── c5162c23a132b377132924f8f1545313861c6cee5a627e9ebbdcf7b7b9d5726f</span>
<span class="go">    └── wrf</span>
<span class="go">        ├── 238a7d219b7c8e285db28fe4f0c96ebe5068d91c.patch?full_index=1-27c7268 -&gt; ../_source-cache/archive/27/27c7268f6c84b884d21e4afad0bab8554b06961cf4d6bfd7d0f5a457dcfdffb1</span>
<span class="go">        ├── 6502d5d9c15f5f9a652dec244cc12434af737c3c.patch?full_index=1-c5162c2 -&gt; ../_source-cache/archive/c5/c5162c23a132b377132924f8f1545313861c6cee5a627e9ebbdcf7b7b9d5726f</span>
<span class="go">        ├── 7c6fd575b7a8fe5715b07b38db160e606c302956.patch?full_index=1-1ce97f4 -&gt; ../_source-cache/archive/1c/1ce97f4fd09e440bdf00f67711b1c50439ac27595ea6796efbfb32e0b9a1f3e4</span>
<span class="go">        └── wrf-3.9.1.1.tar.gz -&gt; ../_source-cache/archive/a0/a04f5c425bedd262413ec88192a0f0896572cc38549de85ca120863c43df047a.tar.gz</span>
</pre></div>
</div>
<p>The various parts of this directory structure are defined as:
* <code class="docutils literal notranslate"><span class="pre">inputs/</span></code>: Contains the Ramble input file mirror
* <code class="docutils literal notranslate"><span class="pre">software</span></code>: Contains the Spack software tarball/zipfile mirror
* <code class="docutils literal notranslate"><span class="pre">input/_input-cache/archive</span></code>: Contains files with names corresponding to the sha256 sums of the associated input files
* <code class="docutils literal notranslate"><span class="pre">software/_source-cache/archive</span></code>: Contains files with names corresponding to the sha256 sums of the associated source tarballs and patch</p>
<blockquote>
<div><p>files.</p>
</div></blockquote>
<p>You can run <code class="docutils literal notranslate"><span class="pre">ramble</span> <span class="pre">workspace</span> <span class="pre">mirror</span> <span class="pre">-d</span> <span class="pre">MIRROR_PATH</span></code>, using the same MIRROR_PATH, from several
different workspaces, in order to populate the local mirror with inputs and source files from
different applications. Alternatively, you can put multiple applications into the same workspace
configuration and create a multi-application mirror in a single run.</p>
<p>Once your mirrors are created locally, you can copy them to any fileserver close to the intended installation.</p>
</section>
<section id="using-created-mirrors">
<span id="id1"></span><h2>Using Created Mirrors<a class="headerlink" href="#using-created-mirrors" title="Link to this heading"></a></h2>
<p>If you have copied the directories into, for example <code class="docutils literal notranslate"><span class="pre">URLBASE</span></code>, with
inputs and software subdirectories under <code class="docutils literal notranslate"><span class="pre">URLBASE</span></code>, you could use them as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ramble<span class="w"> </span>mirror<span class="w"> </span>add<span class="w"> </span>--scope<span class="o">=[</span>site,user<span class="o">]</span><span class="w"> </span>URLBASE/inputs

<span class="gp">$ </span>spack<span class="w"> </span>mirror<span class="w"> </span>add<span class="w"> </span>URLBASE/software
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Google LLC.
      <span class="lastupdated">Last updated on Oct 17, 2023.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>